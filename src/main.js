/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// src/main.ts
var main_exports = {};
__export(main_exports, {
  default: () => GranolaPluginCompanion
});
module.exports = __toCommonJS(main_exports);
var import_obsidian2 = require("obsidian");

// src/services/IntegrationService.ts
var import_obsidian = require("obsidian");

// src/utils/yamlParser.ts
var YamlParser = class {
  constructor(app) {
    this.app = app;
  }
  /**
   * Extrai frontmatter YAML de um arquivo
   */
  extractFrontmatter(content) {
    const frontmatterRegex = /^---\n([\s\S]*?)\n---\n([\s\S]*)$/;
    const match = content.match(frontmatterRegex);
    if (!match) {
      return { frontmatter: {}, body: content };
    }
    const frontmatterText = match[1];
    const body = match[2];
    const frontmatter = {};
    try {
      const lines = frontmatterText.split("\n");
      for (const line of lines) {
        const colonIndex = line.indexOf(":");
        if (colonIndex > 0) {
          const key = line.substring(0, colonIndex).trim();
          const value = line.substring(colonIndex + 1).trim().replace(/^["']|["']$/g, "");
          frontmatter[key] = value;
        }
      }
    } catch (error) {
      console.warn("Error parsing frontmatter:", error);
    }
    return { frontmatter, body };
  }
  /**
   * Verifica se um arquivo tem granola_id no frontmatter
   */
  hasGranolaId(file) {
    var _a;
    const cache = this.app.metadataCache.getFileCache(file);
    return ((_a = cache == null ? void 0 : cache.frontmatter) == null ? void 0 : _a.granola_id) !== void 0;
  }
  /**
   * Obtém o granola_id de um arquivo
   */
  getGranolaId(file) {
    var _a;
    const cache = this.app.metadataCache.getFileCache(file);
    return ((_a = cache == null ? void 0 : cache.frontmatter) == null ? void 0 : _a.granola_id) || null;
  }
  /**
   * Obtém o updated_at de um arquivo
   */
  getUpdatedAt(file) {
    var _a;
    const cache = this.app.metadataCache.getFileCache(file);
    return ((_a = cache == null ? void 0 : cache.frontmatter) == null ? void 0 : _a.updated_at) || null;
  }
};

// src/services/FileLookupService.ts
var FileLookupService = class {
  constructor(app) {
    this.app = app;
    this.yamlParser = new YamlParser(app);
  }
  /**
   * Procura arquivo por granola_id em todo o vault
   */
  async findFileByGranolaId(granolaId) {
    const allFiles = this.app.vault.getFiles();
    for (const file of allFiles) {
      const fileGranolaId = this.yamlParser.getGranolaId(file);
      if (fileGranolaId === granolaId) {
        return file;
      }
    }
    return null;
  }
  /**
   * Verifica se já existe arquivo com este granola_id
   */
  async fileExistsWithGranolaId(granolaId) {
    const existingFile = await this.findFileByGranolaId(granolaId);
    return existingFile !== null;
  }
  /**
   * Lista todos os arquivos com granola_id
   */
  async getAllGranolaFiles() {
    const allFiles = this.app.vault.getFiles();
    const granolaFiles = [];
    for (const file of allFiles) {
      if (this.yamlParser.hasGranolaId(file)) {
        granolaFiles.push(file);
      }
    }
    return granolaFiles;
  }
  /**
   * Obtém arquivos duplicados (mesmo granola_id)
   * Ignora transcripts que compartilham granola_id com suas notas relacionadas
   */
  async getDuplicateFiles() {
    const granolaFiles = await this.getAllGranolaFiles();
    const granolaIdMap = /* @__PURE__ */ new Map();
    for (const file of granolaFiles) {
      const granolaId = this.yamlParser.getGranolaId(file);
      if (granolaId) {
        if (!granolaIdMap.has(granolaId)) {
          granolaIdMap.set(granolaId, []);
        }
        granolaIdMap.get(granolaId).push(file);
      }
    }
    const duplicates = [];
    for (const [granolaId, files] of granolaIdMap) {
      const nonTranscriptFiles = files.filter(
        (file) => !file.name.toLowerCase().includes("transcript")
      );
      if (nonTranscriptFiles.length > 1) {
        duplicates.push({ granolaId, files: nonTranscriptFiles });
      }
    }
    return duplicates;
  }
  /**
   * Intercepta criação de arquivo para prevenir duplicatas
   */
  async interceptFileCreation(filePath, content) {
    var _a, _b;
    if (!((_a = this.settings) == null ? void 0 : _a.duplicatePreventionEnabled)) {
      return { shouldCreate: true };
    }
    const { frontmatter } = this.yamlParser.extractFrontmatter(content);
    const granolaId = frontmatter.granola_id;
    if (!granolaId) {
      return { shouldCreate: true };
    }
    const existingFile = await this.findFileByGranolaId(granolaId);
    if (!existingFile) {
      return { shouldCreate: true };
    }
    if ((_b = this.settings) == null ? void 0 : _b.debugMode) {
      console.log(`Granola Companion: Preventing duplicate creation for granola_id: ${granolaId}`);
      console.log(`Existing file: ${existingFile.path}`);
      console.log(`Attempted new file: ${filePath}`);
    }
    return {
      shouldCreate: false,
      alternativePath: existingFile.path
    };
  }
  setSettings(settings) {
    this.settings = settings;
  }
};

// src/services/IntegrationService.ts
var IntegrationService = class {
  constructor(app) {
    this.app = app;
    this.fileLookupService = new FileLookupService(app);
  }
  /**
   * Inicia a interceptação de operações de arquivo
   */
  async initialize(settings) {
    this.settings = settings;
    this.fileLookupService.setSettings(settings);
    if (!settings.duplicatePreventionEnabled) {
      return;
    }
    await this.interceptVaultOperations();
    if (settings.debugMode) {
      console.log("Granola Companion: Integration service initialized");
    }
  }
  /**
   * Intercepta operações do vault para prevenir duplicatas
   */
  async interceptVaultOperations() {
    const vault = this.app.vault;
    this.originalCreateFile = vault.create.bind(vault);
    this.originalModifyFile = vault.modify.bind(vault);
    const self = this;
    vault.create = async function(path, content, options) {
      if (!content) {
        return self.originalCreateFile(path, content, options);
      }
      const result = await self.fileLookupService.interceptFileCreation(path, content);
      if (result.shouldCreate) {
        return self.originalCreateFile(path, content, options);
      }
      if (result.alternativePath) {
        self.showDuplicateWarning(path, result.alternativePath);
      }
      const existingFile = await self.app.vault.getAbstractFileByPath(result.alternativePath);
      if (existingFile instanceof import_obsidian.TFile) {
        return existingFile;
      }
      return self.originalCreateFile(path, content, options);
    };
    if (this.settings.debugMode) {
      console.log("Granola Companion: File operations intercepted");
    }
  }
  /**
   * Mostra aviso sobre duplicata prevenida
   */
  showDuplicateWarning(attemptedPath, existingPath) {
    const notice = document.createElement("div");
    notice.innerHTML = `
            <div style="padding: 10px; border-left: 4px solid #ff6b6b; margin: 10px 0;">
                <strong>Granola Companion:</strong> Duplicate file prevented<br>
                <small>Attempted: ${attemptedPath}</small><br>
                <small>Existing: ${existingPath}</small>
            </div>
        `;
    if (this.app.notice) {
      this.app.notice(notice, 1e4);
    } else {
      console.warn("Granola Companion: Duplicate prevented", { attemptedPath, existingPath });
    }
  }
  /**
   * Para a interceptação
   */
  stop() {
    const vault = this.app.vault;
    if (this.originalCreateFile) {
      vault.create = this.originalCreateFile;
    }
    if (this.originalModifyFile) {
      vault.modify = this.originalModifyFile;
    }
    if (this.settings.debugMode) {
      console.log("Granola Companion: Integration service stopped");
    }
  }
  /**
   * Verifica se um arquivo parece ser do Granola Sync
   */
  isGranolaSyncFile(path, content) {
    const granolaPattern = /- \d{4}-\d{2}-\d{2}/;
    if (granolaPattern.test(path)) {
      return true;
    }
    if (content) {
      const granolaIdMatch = content.match(/granola_id:\s*([a-f0-9-]+)/i);
      if (granolaIdMatch) {
        return true;
      }
    }
    return false;
  }
  /**
   * Obtém estatísticas de duplicatas
   */
  async getDuplicateStats() {
    const duplicates = await this.fileLookupService.getDuplicateFiles();
    const totalDuplicates = duplicates.reduce((sum, group) => sum + group.files.length - 1, 0);
    return {
      duplicateGroups: duplicates.length,
      totalDuplicateFiles: totalDuplicates,
      duplicates: duplicates.map((group) => ({
        granolaId: group.granolaId,
        count: group.files.length,
        files: group.files.map((f) => f.path)
      }))
    };
  }
};

// src/utils/pluginDetector.ts
var PluginDetector = class {
  constructor(app) {
    this.pluginId = "granola-sync";
    this.app = app;
  }
  /**
   * Gets information about the Granola Sync plugin
   */
  getGranolaSyncInfo() {
    try {
      const pluginsAPI = this.app.plugins;
      const manifests = pluginsAPI.manifests || {};
      const manifest = manifests[this.pluginId];
      const isInstalled = !!manifest;
      let isEnabled = false;
      if (pluginsAPI.plugins && pluginsAPI.plugins[this.pluginId]) {
        isEnabled = true;
      }
      if (!isEnabled && pluginsAPI.enabledPlugins) {
        isEnabled = pluginsAPI.enabledPlugins.has(this.pluginId);
      }
      const isAvailable = isInstalled && isEnabled;
      return {
        installed: isInstalled,
        enabled: isEnabled,
        available: isAvailable,
        manifest: manifest || void 0
      };
    } catch (error) {
      console.warn("Error checking Granola Sync status:", error);
      return {
        installed: false,
        available: false,
        enabled: false
      };
    }
  }
  /**
   * Shows a warning when Granola Sync is not available
   * Provides specific guidance based on the current state
   */
  showDependencyWarning(info) {
    if (!info) {
      info = this.getGranolaSyncInfo();
    }
    let statusMessage;
    let actionMessage;
    if (!info.installed) {
      statusMessage = "Granola Sync is not installed";
      actionMessage = "Please install <strong>Granola Sync</strong> from the Community Plugins settings.";
    } else if (!info.enabled) {
      statusMessage = "Granola Sync is installed but disabled";
      actionMessage = "Please enable <strong>Granola Sync</strong> in the Community Plugins settings.";
    } else {
      statusMessage = "Granola Sync status unknown";
      actionMessage = "Please check your plugin configuration.";
    }
    const message = document.createElement("div");
    message.style.cssText = `
            padding: 10px;
            border-left: 4px solid #ff9800;
            margin: 10px 0;
            background: #fff3e0;
        `;
    message.innerHTML = `
            <strong>Granola Plugin Companion</strong> requires <strong>Granola Sync</strong> to function properly.
            <p>${actionMessage}</p>
            <p><em>Current status: ${statusMessage}</em></p>
        `;
    if (this.app.notice) {
      this.app.notice(message, 1e4);
    } else {
      console.warn(`Granola Companion: ${statusMessage}`);
    }
  }
};

// src/main.ts
var DEFAULT_SETTINGS = {
  duplicatePreventionEnabled: false,
  debugMode: false
};
var GranolaPluginCompanion = class extends import_obsidian2.Plugin {
  constructor() {
    super(...arguments);
    this.granolaSyncAvailable = false;
    this.statusCheckInterval = null;
  }
  async onload() {
    await this.loadSettings();
    this.pluginDetector = new PluginDetector(this.app);
    const granolaSyncInfo = this.pluginDetector.getGranolaSyncInfo();
    this.granolaSyncAvailable = granolaSyncInfo.available;
    if (!granolaSyncInfo.available) {
      this.pluginDetector.showDependencyWarning(granolaSyncInfo);
      this.addSettingTab(new GranolaCompanionSettingTab(this.app, this, false));
      if (!granolaSyncInfo.installed) {
        console.log("Granola Plugin Companion loaded (Granola Sync not installed)");
      } else if (!granolaSyncInfo.enabled) {
        console.log("Granola Plugin Companion loaded (Granola Sync installed but disabled)");
      }
      this.setupStatusCheck();
      return;
    }
    this.integrationService = new IntegrationService(this.app);
    await this.integrationService.initialize(this.settings);
    this.addRibbonIcon("dice", "Granola Companion", (evt) => {
      this.showDuplicateStats();
    });
    this.addCommand({
      id: "open-granola-companion-settings",
      name: "Open Granola Companion Settings",
      callback: () => {
        this.openSettings();
      }
    });
    this.addCommand({
      id: "show-duplicate-stats",
      name: "Show Duplicate Statistics",
      callback: () => {
        this.showDuplicateStats();
      }
    });
    this.addCommand({
      id: "refresh-granola-sync-status",
      name: "Refresh Granola Sync Status",
      callback: () => {
        this.refreshGranolaSyncStatus();
      }
    });
    this.addSettingTab(new GranolaCompanionSettingTab(this.app, this, true));
    this.setupStatusCheck();
    console.log("Granola Plugin Companion loaded (Granola Sync available)");
  }
  onunload() {
    if (this.statusCheckInterval) {
      clearInterval(this.statusCheckInterval);
      this.statusCheckInterval = null;
    }
    if (this.integrationService) {
      this.integrationService.stop();
    }
    console.log("Granola Plugin Companion unloaded");
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
    if (this.integrationService) {
      await this.integrationService.initialize(this.settings);
    }
  }
  async showDuplicateStats() {
    const stats = await this.integrationService.getDuplicateStats();
    if (stats.duplicateGroups === 0) {
      this.showNotice("\u2705 No duplicate files found!", "success");
      return;
    }
    const message = `
\u{1F4CA} Duplicate Statistics:
\u2022 Groups: ${stats.duplicateGroups}
\u2022 Duplicate files: ${stats.totalDuplicateFiles}

Recent duplicates:
${stats.duplicates.slice(0, 5).map((d) => `\u2022 ${d.granolaId}: ${d.count} files`).join("\n")}
        `;
    this.showNotice(message.trim(), "info");
  }
  showNotice(message, type = "info") {
    const notice = document.createElement("div");
    notice.style.cssText = `
            padding: 10px;
            border-left: 4px solid ${type === "success" ? "#4caf50" : type === "warning" ? "#ff9800" : "#2196f3"};
            margin: 10px 0;
            background: ${type === "success" ? "#f1f8e9" : type === "warning" ? "#fff3e0" : "#e3f2fd"};
        `;
    notice.innerHTML = `<strong>Granola Companion:</strong> ${message}`;
    if (this.app.notice) {
      this.app.notice(notice, 8e3);
    } else {
      console.log(`Granola Companion: ${message}`);
    }
  }
  openSettings() {
  }
  async refreshGranolaSyncStatus() {
    const currentInfo = this.pluginDetector.getGranolaSyncInfo();
    const wasAvailable = this.granolaSyncAvailable;
    if (currentInfo.available !== wasAvailable) {
      console.log("Granola Sync availability changed:", {
        from: wasAvailable ? "available" : "unavailable",
        to: currentInfo.available ? "available" : "unavailable",
        installed: currentInfo.installed,
        enabled: currentInfo.enabled
      });
      if (currentInfo.available && !wasAvailable) {
        console.log("Granola Sync now available - initializing integration");
        if (!this.integrationService) {
          this.integrationService = new IntegrationService(this.app);
        }
        await this.integrationService.initialize(this.settings);
        if (!this.ribbonIconEl) {
          this.addRibbonIcon("dice", "Granola Companion", (evt) => {
            this.showDuplicateStats();
          });
        }
      }
      if (!currentInfo.available && wasAvailable) {
        console.log("Granola Sync no longer available - stopping integration");
        if (this.integrationService) {
          this.integrationService.stop();
        }
      }
      this.granolaSyncAvailable = currentInfo.available;
      this.showStatusChangeNotification(currentInfo);
    }
  }
  showStatusChangeNotification(info) {
    let message;
    let iconColor;
    let bgColor;
    if (info.available) {
      message = "\u2705 Granola Sync is now available - full functionality enabled";
      iconColor = "#4caf50";
      bgColor = "#f1f8e9";
    } else if (info.installed && !info.enabled) {
      message = "\u26A0\uFE0F Granola Sync is disabled - please enable it to use Granola Companion";
      iconColor = "#ff9800";
      bgColor = "#fff3e0";
    } else {
      message = "\u26A0\uFE0F Granola Sync is not installed - please install it to use Granola Companion";
      iconColor = "#ff9800";
      bgColor = "#fff3e0";
    }
    const notice = document.createElement("div");
    notice.style.cssText = `
            padding: 15px;
            border-left: 4px solid ${iconColor};
            margin: 10px 0;
            background: ${bgColor};
        `;
    notice.innerHTML = `<strong>Granola Companion:</strong> ${message}`;
    const fragment = document.createDocumentFragment();
    fragment.appendChild(notice);
    new import_obsidian2.Notice(fragment, 8e3);
  }
  setupStatusCheck() {
    var _a;
    const checkStatus = () => {
      this.refreshGranolaSyncStatus();
    };
    if ((_a = this.app.workspace) == null ? void 0 : _a.onLayoutReady) {
      this.app.workspace.onLayoutReady(() => {
        checkStatus();
        this.statusCheckInterval = setInterval(checkStatus, 30 * 1e3);
      });
    } else {
      checkStatus();
      this.statusCheckInterval = setInterval(checkStatus, 30 * 1e3);
    }
  }
};
var GranolaCompanionSettingTab = class extends import_obsidian2.PluginSettingTab {
  constructor(app, plugin, granolaSyncAvailable = true) {
    super(app, plugin);
    this.granolaSyncAvailable = granolaSyncAvailable;
  }
  display() {
    let { containerEl } = this;
    containerEl.empty();
    containerEl.createEl("h2", { text: "Granola Plugin Companion Settings" });
    if (!this.granolaSyncAvailable) {
      const warningEl = containerEl.createEl("div", { cls: "setting-item" });
      warningEl.createEl("div", { cls: "setting-item-info" }, (info) => {
        info.createEl("div", { text: "\u26A0\uFE0F Plugin Dependency Required" });
      });
      warningEl.createEl("div", { cls: "setting-item-description" }, (desc) => {
        desc.innerHTML = `
                    <p><strong>Granola Plugin Companion</strong> requires the original <strong>Obsidian Granola Sync</strong> plugin to function properly.</p>
                    <p>Please install and enable <strong>Granola Sync</strong> from the Community Plugins catalog.</p>
                    <p><em>Current status: Granola Sync not detected</em></p>
                `;
      });
      return;
    }
    new import_obsidian2.Setting(containerEl).setName("Enable Duplicate Prevention").setDesc("Prevent creation of duplicate files when synced notes are modified").addToggle((toggle) => toggle.setValue(this.plugin.settings.duplicatePreventionEnabled).onChange(async (value) => {
      this.plugin.settings.duplicatePreventionEnabled = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian2.Setting(containerEl).setName("Debug Mode").setDesc("Enable debug logging for troubleshooting").addToggle((toggle) => toggle.setValue(this.plugin.settings.debugMode).onChange(async (value) => {
      this.plugin.settings.debugMode = value;
      await this.plugin.saveSettings();
    }));
    containerEl.createEl("div", { cls: "setting-item" }, (div) => {
      div.createEl("div", { cls: "setting-item-info" }, (info) => {
        info.createEl("div", { text: "Statistics" });
        info.createEl("div", { cls: "setting-item-description", text: "View duplicate file statistics and cleanup options" });
      });
      div.createEl("div", { cls: "setting-item-control" }, (control) => {
        const button = control.createEl("button", {
          cls: "mod-cta",
          text: "Show Duplicate Stats"
        });
        button.onclick = () => {
          this.plugin.showDuplicateStats();
        };
      });
    });
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyIsICJzZXJ2aWNlcy9JbnRlZ3JhdGlvblNlcnZpY2UudHMiLCAidXRpbHMveWFtbFBhcnNlci50cyIsICJzZXJ2aWNlcy9GaWxlTG9va3VwU2VydmljZS50cyIsICJ1dGlscy9wbHVnaW5EZXRlY3Rvci50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgQXBwLCBQbHVnaW4sIFBsdWdpblNldHRpbmdUYWIsIFNldHRpbmcsIE5vdGljZSB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCB7IEludGVncmF0aW9uU2VydmljZSB9IGZyb20gJy4vc2VydmljZXMvSW50ZWdyYXRpb25TZXJ2aWNlJztcbmltcG9ydCB7IFBsdWdpbkRldGVjdG9yLCBHcmFub2xhU3luY0luZm8gfSBmcm9tICcuL3V0aWxzL3BsdWdpbkRldGVjdG9yJztcblxuaW50ZXJmYWNlIENvbXBhbmlvblNldHRpbmdzIHtcbiAgICBkdXBsaWNhdGVQcmV2ZW50aW9uRW5hYmxlZDogYm9vbGVhbjtcbiAgICBkZWJ1Z01vZGU6IGJvb2xlYW47XG59XG5cbmNvbnN0IERFRkFVTFRfU0VUVElOR1M6IENvbXBhbmlvblNldHRpbmdzID0ge1xuICAgIGR1cGxpY2F0ZVByZXZlbnRpb25FbmFibGVkOiBmYWxzZSxcbiAgICBkZWJ1Z01vZGU6IGZhbHNlXG59O1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBHcmFub2xhUGx1Z2luQ29tcGFuaW9uIGV4dGVuZHMgUGx1Z2luIHtcbiAgICBzZXR0aW5nczogQ29tcGFuaW9uU2V0dGluZ3M7XG4gICAgaW50ZWdyYXRpb25TZXJ2aWNlOiBJbnRlZ3JhdGlvblNlcnZpY2U7XG4gICAgcGx1Z2luRGV0ZWN0b3I6IFBsdWdpbkRldGVjdG9yO1xuICAgIHByaXZhdGUgZ3Jhbm9sYVN5bmNBdmFpbGFibGU6IGJvb2xlYW4gPSBmYWxzZTtcbiAgICBwcml2YXRlIHN0YXR1c0NoZWNrSW50ZXJ2YWw6IGFueSA9IG51bGw7XG5cbiAgICBhc3luYyBvbmxvYWQoKSB7XG4gICAgICAgIGF3YWl0IHRoaXMubG9hZFNldHRpbmdzKCk7XG5cbiAgICAgICAgLy8gSW5pY2lhbGl6YSBkZXRlY3RvciBkZSBwbHVnaW5zXG4gICAgICAgIHRoaXMucGx1Z2luRGV0ZWN0b3IgPSBuZXcgUGx1Z2luRGV0ZWN0b3IodGhpcy5hcHApO1xuICAgICAgICBjb25zdCBncmFub2xhU3luY0luZm8gPSB0aGlzLnBsdWdpbkRldGVjdG9yLmdldEdyYW5vbGFTeW5jSW5mbygpO1xuICAgICAgICB0aGlzLmdyYW5vbGFTeW5jQXZhaWxhYmxlID0gZ3Jhbm9sYVN5bmNJbmZvLmF2YWlsYWJsZTtcblxuICAgICAgICAvLyBWZXJpZmljYSBzZSBHcmFub2xhIFN5bmMgZXN0XHUwMEUxIGF2YWlsYWJsZSAoaW5zdGFsYWRvIEUgaGFiaWxpdGFkbylcbiAgICAgICAgaWYgKCFncmFub2xhU3luY0luZm8uYXZhaWxhYmxlKSB7XG4gICAgICAgICAgICAvLyBNb3N0cmEgd2FybmluZyBhcHJvcHJpYWRvIGJhc2VhZG8gbm8gZXN0YWRvXG4gICAgICAgICAgICB0aGlzLnBsdWdpbkRldGVjdG9yLnNob3dEZXBlbmRlbmN5V2FybmluZyhncmFub2xhU3luY0luZm8pO1xuXG4gICAgICAgICAgICAvLyBBZGljaW9uYSBjb25maWd1cmFcdTAwRTdcdTAwRjVlcyBsaW1pdGFkYXMgcXVhbmRvIEdyYW5vbGEgU3luYyBuXHUwMEUzbyBlc3RcdTAwRTEgZGlzcG9uXHUwMEVEdmVsXG4gICAgICAgICAgICB0aGlzLmFkZFNldHRpbmdUYWIobmV3IEdyYW5vbGFDb21wYW5pb25TZXR0aW5nVGFiKHRoaXMuYXBwLCB0aGlzLCBmYWxzZSkpO1xuXG4gICAgICAgICAgICAvLyBMb2cgZGEgcmF6XHUwMEUzbyBlc3BlY1x1MDBFRGZpY2FcbiAgICAgICAgICAgIGlmICghZ3Jhbm9sYVN5bmNJbmZvLmluc3RhbGxlZCkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdHcmFub2xhIFBsdWdpbiBDb21wYW5pb24gbG9hZGVkIChHcmFub2xhIFN5bmMgbm90IGluc3RhbGxlZCknKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIWdyYW5vbGFTeW5jSW5mby5lbmFibGVkKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0dyYW5vbGEgUGx1Z2luIENvbXBhbmlvbiBsb2FkZWQgKEdyYW5vbGEgU3luYyBpbnN0YWxsZWQgYnV0IGRpc2FibGVkKScpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBDUlx1MDBDRFRJQ086IE1hbnRlciBzdGF0dXMgY2hlY2sgYXRpdm8gcGFyYSBkZXRlY3RhciBxdWFuZG8gdXNlciBoYWJpbGl0YXJcbiAgICAgICAgICAgIHRoaXMuc2V0dXBTdGF0dXNDaGVjaygpO1xuXG4gICAgICAgICAgICByZXR1cm47IC8vIE5cdTAwQzNPIGluaWNpYWxpemFyIGludGVncmF0aW9uIHNlcnZpY2VcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEdyYW5vbGEgU3luYyBkaXNwb25cdTAwRUR2ZWwgLSBpbmljaWFsaXphIGZ1bmNpb25hbGlkYWRlIGNvbXBsZXRhXG4gICAgICAgIHRoaXMuaW50ZWdyYXRpb25TZXJ2aWNlID0gbmV3IEludGVncmF0aW9uU2VydmljZSh0aGlzLmFwcCk7XG4gICAgICAgIGF3YWl0IHRoaXMuaW50ZWdyYXRpb25TZXJ2aWNlLmluaXRpYWxpemUodGhpcy5zZXR0aW5ncyk7XG5cbiAgICAgICAgLy8gQWRkIGEgcmliYm9uIGljb25cbiAgICAgICAgdGhpcy5hZGRSaWJib25JY29uKCdkaWNlJywgJ0dyYW5vbGEgQ29tcGFuaW9uJywgKGV2dDogTW91c2VFdmVudCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zaG93RHVwbGljYXRlU3RhdHMoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQWRkIGNvbW1hbmRzXG4gICAgICAgIHRoaXMuYWRkQ29tbWFuZCh7XG4gICAgICAgICAgICBpZDogJ29wZW4tZ3Jhbm9sYS1jb21wYW5pb24tc2V0dGluZ3MnLFxuICAgICAgICAgICAgbmFtZTogJ09wZW4gR3Jhbm9sYSBDb21wYW5pb24gU2V0dGluZ3MnLFxuICAgICAgICAgICAgY2FsbGJhY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLm9wZW5TZXR0aW5ncygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmFkZENvbW1hbmQoe1xuICAgICAgICAgICAgaWQ6ICdzaG93LWR1cGxpY2F0ZS1zdGF0cycsXG4gICAgICAgICAgICBuYW1lOiAnU2hvdyBEdXBsaWNhdGUgU3RhdGlzdGljcycsXG4gICAgICAgICAgICBjYWxsYmFjazogKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuc2hvd0R1cGxpY2F0ZVN0YXRzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuYWRkQ29tbWFuZCh7XG4gICAgICAgICAgICBpZDogJ3JlZnJlc2gtZ3Jhbm9sYS1zeW5jLXN0YXR1cycsXG4gICAgICAgICAgICBuYW1lOiAnUmVmcmVzaCBHcmFub2xhIFN5bmMgU3RhdHVzJyxcbiAgICAgICAgICAgIGNhbGxiYWNrOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZWZyZXNoR3Jhbm9sYVN5bmNTdGF0dXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQWRkIHNldHRpbmdzIHRhYlxuICAgICAgICB0aGlzLmFkZFNldHRpbmdUYWIobmV3IEdyYW5vbGFDb21wYW5pb25TZXR0aW5nVGFiKHRoaXMuYXBwLCB0aGlzLCB0cnVlKSk7XG5cbiAgICAgICAgLy8gQWRpY2lvbmEgdmVyaWZpY2FcdTAwRTdcdTAwRTNvIHBlcmlcdTAwRjNkaWNhIGRvIHN0YXR1cyAoYSBjYWRhIDMwIHNlZ3VuZG9zKVxuICAgICAgICB0aGlzLnNldHVwU3RhdHVzQ2hlY2soKTtcblxuICAgICAgICBjb25zb2xlLmxvZygnR3Jhbm9sYSBQbHVnaW4gQ29tcGFuaW9uIGxvYWRlZCAoR3Jhbm9sYSBTeW5jIGF2YWlsYWJsZSknKTtcbiAgICB9XG5cbiAgICBvbnVubG9hZCgpIHtcbiAgICAgICAgLy8gTGltcGEgdmVyaWZpY2FcdTAwRTdcdTAwRTNvIHBlcmlcdTAwRjNkaWNhXG4gICAgICAgIGlmICh0aGlzLnN0YXR1c0NoZWNrSW50ZXJ2YWwpIHtcbiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5zdGF0dXNDaGVja0ludGVydmFsKTtcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzQ2hlY2tJbnRlcnZhbCA9IG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5pbnRlZ3JhdGlvblNlcnZpY2UpIHtcbiAgICAgICAgICAgIHRoaXMuaW50ZWdyYXRpb25TZXJ2aWNlLnN0b3AoKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zb2xlLmxvZygnR3Jhbm9sYSBQbHVnaW4gQ29tcGFuaW9uIHVubG9hZGVkJyk7XG4gICAgfVxuXG4gICAgYXN5bmMgbG9hZFNldHRpbmdzKCkge1xuICAgICAgICB0aGlzLnNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9TRVRUSU5HUywgYXdhaXQgdGhpcy5sb2FkRGF0YSgpKTtcbiAgICB9XG5cbiAgICBhc3luYyBzYXZlU2V0dGluZ3MoKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuc2F2ZURhdGEodGhpcy5zZXR0aW5ncyk7XG4gICAgICAgIFxuICAgICAgICAvLyBSZS1pbmljaWFsaXphIHNlcnZpXHUwMEU3byBkZSBpbnRlZ3JhXHUwMEU3XHUwMEUzbyBjb20gbm92YXMgY29uZmlndXJhXHUwMEU3XHUwMEY1ZXNcbiAgICAgICAgaWYgKHRoaXMuaW50ZWdyYXRpb25TZXJ2aWNlKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmludGVncmF0aW9uU2VydmljZS5pbml0aWFsaXplKHRoaXMuc2V0dGluZ3MpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYXN5bmMgc2hvd0R1cGxpY2F0ZVN0YXRzKCkge1xuICAgICAgICBjb25zdCBzdGF0cyA9IGF3YWl0IHRoaXMuaW50ZWdyYXRpb25TZXJ2aWNlLmdldER1cGxpY2F0ZVN0YXRzKCk7XG4gICAgICAgIFxuICAgICAgICBpZiAoc3RhdHMuZHVwbGljYXRlR3JvdXBzID09PSAwKSB7XG4gICAgICAgICAgICB0aGlzLnNob3dOb3RpY2UoJ1x1MjcwNSBObyBkdXBsaWNhdGUgZmlsZXMgZm91bmQhJywgJ3N1Y2Nlc3MnKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBgXG5cdUQ4M0RcdURDQ0EgRHVwbGljYXRlIFN0YXRpc3RpY3M6XG5cdTIwMjIgR3JvdXBzOiAke3N0YXRzLmR1cGxpY2F0ZUdyb3Vwc31cblx1MjAyMiBEdXBsaWNhdGUgZmlsZXM6ICR7c3RhdHMudG90YWxEdXBsaWNhdGVGaWxlc31cblxuUmVjZW50IGR1cGxpY2F0ZXM6XG4ke3N0YXRzLmR1cGxpY2F0ZXMuc2xpY2UoMCwgNSkubWFwKGQgPT4gYFx1MjAyMiAke2QuZ3Jhbm9sYUlkfTogJHtkLmNvdW50fSBmaWxlc2ApLmpvaW4oJ1xcbicpfVxuICAgICAgICBgO1xuXG4gICAgICAgIHRoaXMuc2hvd05vdGljZShtZXNzYWdlLnRyaW0oKSwgJ2luZm8nKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHNob3dOb3RpY2UobWVzc2FnZTogc3RyaW5nLCB0eXBlOiAnaW5mbycgfCAnc3VjY2VzcycgfCAnd2FybmluZycgPSAnaW5mbycpIHtcbiAgICAgICAgY29uc3Qgbm90aWNlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIG5vdGljZS5zdHlsZS5jc3NUZXh0ID0gYFxuICAgICAgICAgICAgcGFkZGluZzogMTBweDtcbiAgICAgICAgICAgIGJvcmRlci1sZWZ0OiA0cHggc29saWQgJHt0eXBlID09PSAnc3VjY2VzcycgPyAnIzRjYWY1MCcgOiB0eXBlID09PSAnd2FybmluZycgPyAnI2ZmOTgwMCcgOiAnIzIxOTZmMyd9O1xuICAgICAgICAgICAgbWFyZ2luOiAxMHB4IDA7XG4gICAgICAgICAgICBiYWNrZ3JvdW5kOiAke3R5cGUgPT09ICdzdWNjZXNzJyA/ICcjZjFmOGU5JyA6IHR5cGUgPT09ICd3YXJuaW5nJyA/ICcjZmZmM2UwJyA6ICcjZTNmMmZkJ307XG4gICAgICAgIGA7XG4gICAgICAgIG5vdGljZS5pbm5lckhUTUwgPSBgPHN0cm9uZz5HcmFub2xhIENvbXBhbmlvbjo8L3N0cm9uZz4gJHttZXNzYWdlfWA7XG4gICAgICAgIFxuICAgICAgICBpZiAoKHRoaXMuYXBwIGFzIGFueSkubm90aWNlKSB7XG4gICAgICAgICAgICAodGhpcy5hcHAgYXMgYW55KS5ub3RpY2Uobm90aWNlLCA4MDAwKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBHcmFub2xhIENvbXBhbmlvbjogJHttZXNzYWdlfWApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgb3BlblNldHRpbmdzKCkge1xuICAgICAgICAvLyBUaGlzIHdpbGwgYmUgaW1wbGVtZW50ZWQgaW4gc2V0dGluZ3MgdGFiXG4gICAgfVxuXG4gICAgYXN5bmMgcmVmcmVzaEdyYW5vbGFTeW5jU3RhdHVzKCkge1xuICAgICAgICBjb25zdCBjdXJyZW50SW5mbyA9IHRoaXMucGx1Z2luRGV0ZWN0b3IuZ2V0R3Jhbm9sYVN5bmNJbmZvKCk7XG4gICAgICAgIGNvbnN0IHdhc0F2YWlsYWJsZSA9IHRoaXMuZ3Jhbm9sYVN5bmNBdmFpbGFibGU7XG5cbiAgICAgICAgLy8gVmVyaWZpY2FyIHNlIHN0YXR1cyBkZSBhdmFpbGFiaWxpdHkgbXVkb3VcbiAgICAgICAgaWYgKGN1cnJlbnRJbmZvLmF2YWlsYWJsZSAhPT0gd2FzQXZhaWxhYmxlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnR3Jhbm9sYSBTeW5jIGF2YWlsYWJpbGl0eSBjaGFuZ2VkOicsIHtcbiAgICAgICAgICAgICAgICBmcm9tOiB3YXNBdmFpbGFibGUgPyAnYXZhaWxhYmxlJyA6ICd1bmF2YWlsYWJsZScsXG4gICAgICAgICAgICAgICAgdG86IGN1cnJlbnRJbmZvLmF2YWlsYWJsZSA/ICdhdmFpbGFibGUnIDogJ3VuYXZhaWxhYmxlJyxcbiAgICAgICAgICAgICAgICBpbnN0YWxsZWQ6IGN1cnJlbnRJbmZvLmluc3RhbGxlZCxcbiAgICAgICAgICAgICAgICBlbmFibGVkOiBjdXJyZW50SW5mby5lbmFibGVkXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gVHJhbnNpXHUwMEU3XHUwMEUzbyBwYXJhIGF2YWlsYWJsZVxuICAgICAgICAgICAgaWYgKGN1cnJlbnRJbmZvLmF2YWlsYWJsZSAmJiAhd2FzQXZhaWxhYmxlKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0dyYW5vbGEgU3luYyBub3cgYXZhaWxhYmxlIC0gaW5pdGlhbGl6aW5nIGludGVncmF0aW9uJyk7XG5cbiAgICAgICAgICAgICAgICAvLyBJbmljaWFsaXphciBpbnRlZ3JhdGlvbiBzZXJ2aWNlIHNlIGFpbmRhIG5cdTAwRTNvIGV4aXN0ZVxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5pbnRlZ3JhdGlvblNlcnZpY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnRlZ3JhdGlvblNlcnZpY2UgPSBuZXcgSW50ZWdyYXRpb25TZXJ2aWNlKHRoaXMuYXBwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5pbnRlZ3JhdGlvblNlcnZpY2UuaW5pdGlhbGl6ZSh0aGlzLnNldHRpbmdzKTtcblxuICAgICAgICAgICAgICAgIC8vIEFkaWNpb25hciBVSSBjb21wbGV0YSBzZSBhaW5kYSBuXHUwMEUzbyBwcmVzZW50ZVxuICAgICAgICAgICAgICAgIGlmICghKHRoaXMgYXMgYW55KS5yaWJib25JY29uRWwpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRSaWJib25JY29uKCdkaWNlJywgJ0dyYW5vbGEgQ29tcGFuaW9uJywgKGV2dDogTW91c2VFdmVudCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93RHVwbGljYXRlU3RhdHMoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBUcmFuc2lcdTAwRTdcdTAwRTNvIHBhcmEgdW5hdmFpbGFibGVcbiAgICAgICAgICAgIGlmICghY3VycmVudEluZm8uYXZhaWxhYmxlICYmIHdhc0F2YWlsYWJsZSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdHcmFub2xhIFN5bmMgbm8gbG9uZ2VyIGF2YWlsYWJsZSAtIHN0b3BwaW5nIGludGVncmF0aW9uJyk7XG5cbiAgICAgICAgICAgICAgICAvLyBQYXJhciBpbnRlZ3JhdGlvbiBzZXJ2aWNlXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaW50ZWdyYXRpb25TZXJ2aWNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW50ZWdyYXRpb25TZXJ2aWNlLnN0b3AoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEF0dWFsaXphciBzdGF0dXMgYXJtYXplbmFkb1xuICAgICAgICAgICAgdGhpcy5ncmFub2xhU3luY0F2YWlsYWJsZSA9IGN1cnJlbnRJbmZvLmF2YWlsYWJsZTtcblxuICAgICAgICAgICAgLy8gTm90aWZpY2FyIHVzdVx1MDBFMXJpb1xuICAgICAgICAgICAgdGhpcy5zaG93U3RhdHVzQ2hhbmdlTm90aWZpY2F0aW9uKGN1cnJlbnRJbmZvKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgc2hvd1N0YXR1c0NoYW5nZU5vdGlmaWNhdGlvbihpbmZvOiBHcmFub2xhU3luY0luZm8pIHtcbiAgICAgICAgbGV0IG1lc3NhZ2U6IHN0cmluZztcbiAgICAgICAgbGV0IGljb25Db2xvcjogc3RyaW5nO1xuICAgICAgICBsZXQgYmdDb2xvcjogc3RyaW5nO1xuXG4gICAgICAgIGlmIChpbmZvLmF2YWlsYWJsZSkge1xuICAgICAgICAgICAgbWVzc2FnZSA9ICdcdTI3MDUgR3Jhbm9sYSBTeW5jIGlzIG5vdyBhdmFpbGFibGUgLSBmdWxsIGZ1bmN0aW9uYWxpdHkgZW5hYmxlZCc7XG4gICAgICAgICAgICBpY29uQ29sb3IgPSAnIzRjYWY1MCc7XG4gICAgICAgICAgICBiZ0NvbG9yID0gJyNmMWY4ZTknO1xuICAgICAgICB9IGVsc2UgaWYgKGluZm8uaW5zdGFsbGVkICYmICFpbmZvLmVuYWJsZWQpIHtcbiAgICAgICAgICAgIG1lc3NhZ2UgPSAnXHUyNkEwXHVGRTBGIEdyYW5vbGEgU3luYyBpcyBkaXNhYmxlZCAtIHBsZWFzZSBlbmFibGUgaXQgdG8gdXNlIEdyYW5vbGEgQ29tcGFuaW9uJztcbiAgICAgICAgICAgIGljb25Db2xvciA9ICcjZmY5ODAwJztcbiAgICAgICAgICAgIGJnQ29sb3IgPSAnI2ZmZjNlMCc7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBtZXNzYWdlID0gJ1x1MjZBMFx1RkUwRiBHcmFub2xhIFN5bmMgaXMgbm90IGluc3RhbGxlZCAtIHBsZWFzZSBpbnN0YWxsIGl0IHRvIHVzZSBHcmFub2xhIENvbXBhbmlvbic7XG4gICAgICAgICAgICBpY29uQ29sb3IgPSAnI2ZmOTgwMCc7XG4gICAgICAgICAgICBiZ0NvbG9yID0gJyNmZmYzZTAnO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgbm90aWNlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIG5vdGljZS5zdHlsZS5jc3NUZXh0ID0gYFxuICAgICAgICAgICAgcGFkZGluZzogMTVweDtcbiAgICAgICAgICAgIGJvcmRlci1sZWZ0OiA0cHggc29saWQgJHtpY29uQ29sb3J9O1xuICAgICAgICAgICAgbWFyZ2luOiAxMHB4IDA7XG4gICAgICAgICAgICBiYWNrZ3JvdW5kOiAke2JnQ29sb3J9O1xuICAgICAgICBgO1xuICAgICAgICBub3RpY2UuaW5uZXJIVE1MID0gYDxzdHJvbmc+R3Jhbm9sYSBDb21wYW5pb246PC9zdHJvbmc+ICR7bWVzc2FnZX1gO1xuXG4gICAgICAgIGNvbnN0IGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChub3RpY2UpO1xuICAgICAgICBuZXcgTm90aWNlKGZyYWdtZW50LCA4MDAwKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHNldHVwU3RhdHVzQ2hlY2soKSB7XG4gICAgICAgIGNvbnN0IGNoZWNrU3RhdHVzID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5yZWZyZXNoR3Jhbm9sYVN5bmNTdGF0dXMoKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBJbml0aWFsIGNoZWNrIGFmdGVyIGxheW91dCBpcyByZWFkeVxuICAgICAgICBpZiAoKHRoaXMuYXBwIGFzIGFueSkud29ya3NwYWNlPy5vbkxheW91dFJlYWR5KSB7XG4gICAgICAgICAgICAodGhpcy5hcHAgYXMgYW55KS53b3Jrc3BhY2Uub25MYXlvdXRSZWFkeSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgLy8gSW5pdGlhbCBjaGVja1xuICAgICAgICAgICAgICAgIGNoZWNrU3RhdHVzKCk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8gU2V0IHVwIHBlcmlvZGljIGNoZWNrc1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhdHVzQ2hlY2tJbnRlcnZhbCA9IHNldEludGVydmFsKGNoZWNrU3RhdHVzLCAzMCAqIDEwMDApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBGYWxsYmFjayBmb3Igb2xkZXIgT2JzaWRpYW4gdmVyc2lvbnNcbiAgICAgICAgICAgIGNoZWNrU3RhdHVzKCk7XG4gICAgICAgICAgICB0aGlzLnN0YXR1c0NoZWNrSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChjaGVja1N0YXR1cywgMzAgKiAxMDAwKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuY2xhc3MgR3Jhbm9sYUNvbXBhbmlvblNldHRpbmdUYWIgZXh0ZW5kcyBQbHVnaW5TZXR0aW5nVGFiIHtcbiAgICBwbHVnaW46IEdyYW5vbGFQbHVnaW5Db21wYW5pb247XG4gICAgcHJpdmF0ZSBncmFub2xhU3luY0F2YWlsYWJsZTogYm9vbGVhbjtcblxuICAgIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwbHVnaW46IEdyYW5vbGFQbHVnaW5Db21wYW5pb24sIGdyYW5vbGFTeW5jQXZhaWxhYmxlOiBib29sZWFuID0gdHJ1ZSkge1xuICAgICAgICBzdXBlcihhcHAsIHBsdWdpbik7XG4gICAgICAgIHRoaXMuZ3Jhbm9sYVN5bmNBdmFpbGFibGUgPSBncmFub2xhU3luY0F2YWlsYWJsZTtcbiAgICB9XG5cbiAgICBkaXNwbGF5KCk6IHZvaWQge1xuICAgICAgICBsZXQgeyBjb250YWluZXJFbCB9ID0gdGhpcztcblxuICAgICAgICBjb250YWluZXJFbC5lbXB0eSgpO1xuXG4gICAgICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKCdoMicsIHsgdGV4dDogJ0dyYW5vbGEgUGx1Z2luIENvbXBhbmlvbiBTZXR0aW5ncycgfSk7XG5cbiAgICAgICAgLy8gTW9zdHJhIGF2aXNvIHNlIEdyYW5vbGEgU3luYyBuXHUwMEUzbyBlc3RpdmVyIGRpc3Bvblx1MDBFRHZlbFxuICAgICAgICBpZiAoIXRoaXMuZ3Jhbm9sYVN5bmNBdmFpbGFibGUpIHtcbiAgICAgICAgICAgIGNvbnN0IHdhcm5pbmdFbCA9IGNvbnRhaW5lckVsLmNyZWF0ZUVsKCdkaXYnLCB7IGNsczogJ3NldHRpbmctaXRlbScgfSk7XG4gICAgICAgICAgICB3YXJuaW5nRWwuY3JlYXRlRWwoJ2RpdicsIHsgY2xzOiAnc2V0dGluZy1pdGVtLWluZm8nIH0sIChpbmZvKSA9PiB7XG4gICAgICAgICAgICAgICAgaW5mby5jcmVhdGVFbCgnZGl2JywgeyB0ZXh0OiAnXHUyNkEwXHVGRTBGIFBsdWdpbiBEZXBlbmRlbmN5IFJlcXVpcmVkJyB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB3YXJuaW5nRWwuY3JlYXRlRWwoJ2RpdicsIHsgY2xzOiAnc2V0dGluZy1pdGVtLWRlc2NyaXB0aW9uJyB9LCAoZGVzYykgPT4ge1xuICAgICAgICAgICAgICAgIGRlc2MuaW5uZXJIVE1MID0gYFxuICAgICAgICAgICAgICAgICAgICA8cD48c3Ryb25nPkdyYW5vbGEgUGx1Z2luIENvbXBhbmlvbjwvc3Ryb25nPiByZXF1aXJlcyB0aGUgb3JpZ2luYWwgPHN0cm9uZz5PYnNpZGlhbiBHcmFub2xhIFN5bmM8L3N0cm9uZz4gcGx1Z2luIHRvIGZ1bmN0aW9uIHByb3Blcmx5LjwvcD5cbiAgICAgICAgICAgICAgICAgICAgPHA+UGxlYXNlIGluc3RhbGwgYW5kIGVuYWJsZSA8c3Ryb25nPkdyYW5vbGEgU3luYzwvc3Ryb25nPiBmcm9tIHRoZSBDb21tdW5pdHkgUGx1Z2lucyBjYXRhbG9nLjwvcD5cbiAgICAgICAgICAgICAgICAgICAgPHA+PGVtPkN1cnJlbnQgc3RhdHVzOiBHcmFub2xhIFN5bmMgbm90IGRldGVjdGVkPC9lbT48L3A+XG4gICAgICAgICAgICAgICAgYDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAgICAgICAuc2V0TmFtZSgnRW5hYmxlIER1cGxpY2F0ZSBQcmV2ZW50aW9uJylcbiAgICAgICAgICAgIC5zZXREZXNjKCdQcmV2ZW50IGNyZWF0aW9uIG9mIGR1cGxpY2F0ZSBmaWxlcyB3aGVuIHN5bmNlZCBub3RlcyBhcmUgbW9kaWZpZWQnKVxuICAgICAgICAgICAgLmFkZFRvZ2dsZSh0b2dnbGUgPT4gdG9nZ2xlXG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmR1cGxpY2F0ZVByZXZlbnRpb25FbmFibGVkKVxuICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZHVwbGljYXRlUHJldmVudGlvbkVuYWJsZWQgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgfSkpO1xuXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoJ0RlYnVnIE1vZGUnKVxuICAgICAgICAgICAgLnNldERlc2MoJ0VuYWJsZSBkZWJ1ZyBsb2dnaW5nIGZvciB0cm91Ymxlc2hvb3RpbmcnKVxuICAgICAgICAgICAgLmFkZFRvZ2dsZSh0b2dnbGUgPT4gdG9nZ2xlXG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmRlYnVnTW9kZSlcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmRlYnVnTW9kZSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICB9KSk7XG5cbiAgICAgICAgLy8gQWRpY2lvbmEgYm90XHUwMEUzbyBwYXJhIG1vc3RyYXIgZXN0YXRcdTAwRURzdGljYXNcbiAgICAgICAgY29udGFpbmVyRWwuY3JlYXRlRWwoJ2RpdicsIHsgY2xzOiAnc2V0dGluZy1pdGVtJyB9LCAoZGl2KSA9PiB7XG4gICAgICAgICAgICBkaXYuY3JlYXRlRWwoJ2RpdicsIHsgY2xzOiAnc2V0dGluZy1pdGVtLWluZm8nIH0sIChpbmZvKSA9PiB7XG4gICAgICAgICAgICAgICAgaW5mby5jcmVhdGVFbCgnZGl2JywgeyB0ZXh0OiAnU3RhdGlzdGljcycgfSk7XG4gICAgICAgICAgICAgICAgaW5mby5jcmVhdGVFbCgnZGl2JywgeyBjbHM6ICdzZXR0aW5nLWl0ZW0tZGVzY3JpcHRpb24nLCB0ZXh0OiAnVmlldyBkdXBsaWNhdGUgZmlsZSBzdGF0aXN0aWNzIGFuZCBjbGVhbnVwIG9wdGlvbnMnIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGRpdi5jcmVhdGVFbCgnZGl2JywgeyBjbHM6ICdzZXR0aW5nLWl0ZW0tY29udHJvbCcgfSwgKGNvbnRyb2wpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBidXR0b24gPSBjb250cm9sLmNyZWF0ZUVsKCdidXR0b24nLCB7IFxuICAgICAgICAgICAgICAgICAgICBjbHM6ICdtb2QtY3RhJyxcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogJ1Nob3cgRHVwbGljYXRlIFN0YXRzJ1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGJ1dHRvbi5vbmNsaWNrID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zaG93RHVwbGljYXRlU3RhdHMoKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbiIsICJpbXBvcnQgeyBBcHAsIFRGaWxlLCBURm9sZGVyIH0gZnJvbSAnb2JzaWRpYW4nO1xuaW1wb3J0IHsgRmlsZUxvb2t1cFNlcnZpY2UgfSBmcm9tICcuL0ZpbGVMb29rdXBTZXJ2aWNlJztcblxuZXhwb3J0IGNsYXNzIEludGVncmF0aW9uU2VydmljZSB7XG4gICAgcHJpdmF0ZSBhcHA6IEFwcDtcbiAgICBwcml2YXRlIGZpbGVMb29rdXBTZXJ2aWNlOiBGaWxlTG9va3VwU2VydmljZTtcbiAgICBwcml2YXRlIG9yaWdpbmFsQ3JlYXRlRmlsZTogYW55O1xuICAgIHByaXZhdGUgb3JpZ2luYWxNb2RpZnlGaWxlOiBhbnk7XG4gICAgcHJpdmF0ZSBzZXR0aW5nczogYW55O1xuXG4gICAgY29uc3RydWN0b3IoYXBwOiBBcHApIHtcbiAgICAgICAgdGhpcy5hcHAgPSBhcHA7XG4gICAgICAgIHRoaXMuZmlsZUxvb2t1cFNlcnZpY2UgPSBuZXcgRmlsZUxvb2t1cFNlcnZpY2UoYXBwKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJbmljaWEgYSBpbnRlcmNlcHRhXHUwMEU3XHUwMEUzbyBkZSBvcGVyYVx1MDBFN1x1MDBGNWVzIGRlIGFycXVpdm9cbiAgICAgKi9cbiAgICBhc3luYyBpbml0aWFsaXplKHNldHRpbmdzOiBhbnkpIHtcbiAgICAgICAgdGhpcy5zZXR0aW5ncyA9IHNldHRpbmdzO1xuICAgICAgICB0aGlzLmZpbGVMb29rdXBTZXJ2aWNlLnNldFNldHRpbmdzKHNldHRpbmdzKTtcblxuICAgICAgICBpZiAoIXNldHRpbmdzLmR1cGxpY2F0ZVByZXZlbnRpb25FbmFibGVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBhd2FpdCB0aGlzLmludGVyY2VwdFZhdWx0T3BlcmF0aW9ucygpO1xuICAgICAgICBcbiAgICAgICAgaWYgKHNldHRpbmdzLmRlYnVnTW9kZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ0dyYW5vbGEgQ29tcGFuaW9uOiBJbnRlZ3JhdGlvbiBzZXJ2aWNlIGluaXRpYWxpemVkJyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJbnRlcmNlcHRhIG9wZXJhXHUwMEU3XHUwMEY1ZXMgZG8gdmF1bHQgcGFyYSBwcmV2ZW5pciBkdXBsaWNhdGFzXG4gICAgICovXG4gICAgcHJpdmF0ZSBhc3luYyBpbnRlcmNlcHRWYXVsdE9wZXJhdGlvbnMoKSB7XG4gICAgICAgIGNvbnN0IHZhdWx0ID0gdGhpcy5hcHAudmF1bHQ7XG4gICAgICAgIFxuICAgICAgICAvLyBTYWx2YSBtXHUwMEU5dG9kb3Mgb3JpZ2luYWlzXG4gICAgICAgIHRoaXMub3JpZ2luYWxDcmVhdGVGaWxlID0gdmF1bHQuY3JlYXRlLmJpbmQodmF1bHQpO1xuICAgICAgICB0aGlzLm9yaWdpbmFsTW9kaWZ5RmlsZSA9IHZhdWx0Lm1vZGlmeS5iaW5kKHZhdWx0KTtcblxuICAgICAgICAvLyBJbnRlcmNlcHRhIGNyaWFcdTAwRTdcdTAwRTNvIGRlIGFycXVpdm9zXG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgICAgICB2YXVsdC5jcmVhdGUgPSBhc3luYyBmdW5jdGlvbihwYXRoOiBzdHJpbmcsIGNvbnRlbnQ/OiBzdHJpbmcsIG9wdGlvbnM/OiBhbnkpIHtcbiAgICAgICAgICAgIGlmICghY29udGVudCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLm9yaWdpbmFsQ3JlYXRlRmlsZShwYXRoLCBjb250ZW50LCBvcHRpb25zKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VsZi5maWxlTG9va3VwU2VydmljZS5pbnRlcmNlcHRGaWxlQ3JlYXRpb24ocGF0aCwgY29udGVudCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChyZXN1bHQuc2hvdWxkQ3JlYXRlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYub3JpZ2luYWxDcmVhdGVGaWxlKHBhdGgsIGNvbnRlbnQsIG9wdGlvbnMpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBBcnF1aXZvIGR1cGxpY2FkbyBkZXRlY3RhZG8gLSBub3RpZmljYXIgdXN1XHUwMEUxcmlvXG4gICAgICAgICAgICBpZiAocmVzdWx0LmFsdGVybmF0aXZlUGF0aCkge1xuICAgICAgICAgICAgICAgIHNlbGYuc2hvd0R1cGxpY2F0ZVdhcm5pbmcocGF0aCwgcmVzdWx0LmFsdGVybmF0aXZlUGF0aCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFJldG9ybmEgbyBhcnF1aXZvIGV4aXN0ZW50ZSBlbSB2ZXogZGUgY3JpYXIgZHVwbGljYXRhXG4gICAgICAgICAgICBjb25zdCBleGlzdGluZ0ZpbGUgPSBhd2FpdCBzZWxmLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgocmVzdWx0LmFsdGVybmF0aXZlUGF0aCEpO1xuICAgICAgICAgICAgaWYgKGV4aXN0aW5nRmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGV4aXN0aW5nRmlsZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcmV0dXJuIHNlbGYub3JpZ2luYWxDcmVhdGVGaWxlKHBhdGgsIGNvbnRlbnQsIG9wdGlvbnMpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGlmICh0aGlzLnNldHRpbmdzLmRlYnVnTW9kZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ0dyYW5vbGEgQ29tcGFuaW9uOiBGaWxlIG9wZXJhdGlvbnMgaW50ZXJjZXB0ZWQnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE1vc3RyYSBhdmlzbyBzb2JyZSBkdXBsaWNhdGEgcHJldmVuaWRhXG4gICAgICovXG4gICAgcHJpdmF0ZSBzaG93RHVwbGljYXRlV2FybmluZyhhdHRlbXB0ZWRQYXRoOiBzdHJpbmcsIGV4aXN0aW5nUGF0aDogc3RyaW5nKSB7XG4gICAgICAgIGNvbnN0IG5vdGljZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBub3RpY2UuaW5uZXJIVE1MID0gYFxuICAgICAgICAgICAgPGRpdiBzdHlsZT1cInBhZGRpbmc6IDEwcHg7IGJvcmRlci1sZWZ0OiA0cHggc29saWQgI2ZmNmI2YjsgbWFyZ2luOiAxMHB4IDA7XCI+XG4gICAgICAgICAgICAgICAgPHN0cm9uZz5HcmFub2xhIENvbXBhbmlvbjo8L3N0cm9uZz4gRHVwbGljYXRlIGZpbGUgcHJldmVudGVkPGJyPlxuICAgICAgICAgICAgICAgIDxzbWFsbD5BdHRlbXB0ZWQ6ICR7YXR0ZW1wdGVkUGF0aH08L3NtYWxsPjxicj5cbiAgICAgICAgICAgICAgICA8c21hbGw+RXhpc3Rpbmc6ICR7ZXhpc3RpbmdQYXRofTwvc21hbGw+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgYDtcbiAgICAgICAgXG4gICAgICAgIC8vIEFkaWNpb25hIGFvIHZhdWx0IHNlIHRpdmVyIHN1cG9ydGUgYSBub3RpZmljYVx1MDBFN1x1MDBGNWVzIGN1c3RvbWl6YWRhc1xuICAgICAgICBpZiAoKHRoaXMuYXBwIGFzIGFueSkubm90aWNlKSB7XG4gICAgICAgICAgICAodGhpcy5hcHAgYXMgYW55KS5ub3RpY2Uobm90aWNlLCAxMDAwMCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ0dyYW5vbGEgQ29tcGFuaW9uOiBEdXBsaWNhdGUgcHJldmVudGVkJywgeyBhdHRlbXB0ZWRQYXRoLCBleGlzdGluZ1BhdGggfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBQYXJhIGEgaW50ZXJjZXB0YVx1MDBFN1x1MDBFM29cbiAgICAgKi9cbiAgICBzdG9wKCkge1xuICAgICAgICBjb25zdCB2YXVsdCA9IHRoaXMuYXBwLnZhdWx0O1xuICAgICAgICBpZiAodGhpcy5vcmlnaW5hbENyZWF0ZUZpbGUpIHtcbiAgICAgICAgICAgIHZhdWx0LmNyZWF0ZSA9IHRoaXMub3JpZ2luYWxDcmVhdGVGaWxlO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLm9yaWdpbmFsTW9kaWZ5RmlsZSkge1xuICAgICAgICAgICAgdmF1bHQubW9kaWZ5ID0gdGhpcy5vcmlnaW5hbE1vZGlmeUZpbGU7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGlmICh0aGlzLnNldHRpbmdzLmRlYnVnTW9kZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ0dyYW5vbGEgQ29tcGFuaW9uOiBJbnRlZ3JhdGlvbiBzZXJ2aWNlIHN0b3BwZWQnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFZlcmlmaWNhIHNlIHVtIGFycXVpdm8gcGFyZWNlIHNlciBkbyBHcmFub2xhIFN5bmNcbiAgICAgKi9cbiAgICBpc0dyYW5vbGFTeW5jRmlsZShwYXRoOiBzdHJpbmcsIGNvbnRlbnQ/OiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgLy8gVmVyaWZpY2EgcGVsbyBwYWRyXHUwMEUzbyBkZSBub21lXG4gICAgICAgIGNvbnN0IGdyYW5vbGFQYXR0ZXJuID0gLy0gXFxkezR9LVxcZHsyfS1cXGR7Mn0vO1xuICAgICAgICBpZiAoZ3Jhbm9sYVBhdHRlcm4udGVzdChwYXRoKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBWZXJpZmljYSBwZWxvIGNvbnRlXHUwMEZBZG8gc2UgZm9ybmVjaWRvXG4gICAgICAgIGlmIChjb250ZW50KSB7XG4gICAgICAgICAgICBjb25zdCBncmFub2xhSWRNYXRjaCA9IGNvbnRlbnQubWF0Y2goL2dyYW5vbGFfaWQ6XFxzKihbYS1mMC05LV0rKS9pKTtcbiAgICAgICAgICAgIGlmIChncmFub2xhSWRNYXRjaCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE9idFx1MDBFOW0gZXN0YXRcdTAwRURzdGljYXMgZGUgZHVwbGljYXRhc1xuICAgICAqL1xuICAgIGFzeW5jIGdldER1cGxpY2F0ZVN0YXRzKCkge1xuICAgICAgICBjb25zdCBkdXBsaWNhdGVzID0gYXdhaXQgdGhpcy5maWxlTG9va3VwU2VydmljZS5nZXREdXBsaWNhdGVGaWxlcygpO1xuICAgICAgICBjb25zdCB0b3RhbER1cGxpY2F0ZXMgPSBkdXBsaWNhdGVzLnJlZHVjZSgoc3VtLCBncm91cCkgPT4gc3VtICsgZ3JvdXAuZmlsZXMubGVuZ3RoIC0gMSwgMCk7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZHVwbGljYXRlR3JvdXBzOiBkdXBsaWNhdGVzLmxlbmd0aCxcbiAgICAgICAgICAgIHRvdGFsRHVwbGljYXRlRmlsZXM6IHRvdGFsRHVwbGljYXRlcyxcbiAgICAgICAgICAgIGR1cGxpY2F0ZXM6IGR1cGxpY2F0ZXMubWFwKGdyb3VwID0+ICh7XG4gICAgICAgICAgICAgICAgZ3Jhbm9sYUlkOiBncm91cC5ncmFub2xhSWQsXG4gICAgICAgICAgICAgICAgY291bnQ6IGdyb3VwLmZpbGVzLmxlbmd0aCxcbiAgICAgICAgICAgICAgICBmaWxlczogZ3JvdXAuZmlsZXMubWFwKGYgPT4gZi5wYXRoKVxuICAgICAgICAgICAgfSkpXG4gICAgICAgIH07XG4gICAgfVxufSIsICJpbXBvcnQgeyBURmlsZSwgQXBwIH0gZnJvbSAnb2JzaWRpYW4nO1xuXG5leHBvcnQgaW50ZXJmYWNlIEdyYW5vbGFGcm9udG1hdHRlciB7XG4gICAgZ3Jhbm9sYV9pZD86IHN0cmluZztcbiAgICB1cGRhdGVkX2F0Pzogc3RyaW5nO1xuICAgIHR5cGU/OiAnbm90ZScgfCAndHJhbnNjcmlwdCc7XG59XG5cbmV4cG9ydCBjbGFzcyBZYW1sUGFyc2VyIHtcbiAgICBwcml2YXRlIGFwcDogQXBwO1xuXG4gICAgY29uc3RydWN0b3IoYXBwOiBBcHApIHtcbiAgICAgICAgdGhpcy5hcHAgPSBhcHA7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRXh0cmFpIGZyb250bWF0dGVyIFlBTUwgZGUgdW0gYXJxdWl2b1xuICAgICAqL1xuICAgIGV4dHJhY3RGcm9udG1hdHRlcihjb250ZW50OiBzdHJpbmcpOiB7IGZyb250bWF0dGVyOiBHcmFub2xhRnJvbnRtYXR0ZXI7IGJvZHk6IHN0cmluZyB9IHtcbiAgICAgICAgY29uc3QgZnJvbnRtYXR0ZXJSZWdleCA9IC9eLS0tXFxuKFtcXHNcXFNdKj8pXFxuLS0tXFxuKFtcXHNcXFNdKikkLztcbiAgICAgICAgY29uc3QgbWF0Y2ggPSBjb250ZW50Lm1hdGNoKGZyb250bWF0dGVyUmVnZXgpO1xuICAgICAgICBcbiAgICAgICAgaWYgKCFtYXRjaCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgZnJvbnRtYXR0ZXI6IHt9LCBib2R5OiBjb250ZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBmcm9udG1hdHRlclRleHQgPSBtYXRjaFsxXTtcbiAgICAgICAgY29uc3QgYm9keSA9IG1hdGNoWzJdO1xuICAgICAgICBjb25zdCBmcm9udG1hdHRlcjogR3Jhbm9sYUZyb250bWF0dGVyID0ge307XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIFBhcnNlIFlBTUwgc2ltcGxlc1xuICAgICAgICAgICAgY29uc3QgbGluZXMgPSBmcm9udG1hdHRlclRleHQuc3BsaXQoJ1xcbicpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY29sb25JbmRleCA9IGxpbmUuaW5kZXhPZignOicpO1xuICAgICAgICAgICAgICAgIGlmIChjb2xvbkluZGV4ID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBrZXkgPSBsaW5lLnN1YnN0cmluZygwLCBjb2xvbkluZGV4KS50cmltKCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gbGluZS5zdWJzdHJpbmcoY29sb25JbmRleCArIDEpLnRyaW0oKS5yZXBsYWNlKC9eW1wiJ118W1wiJ10kL2csICcnKTtcbiAgICAgICAgICAgICAgICAgICAgKGZyb250bWF0dGVyIGFzIGFueSlba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybignRXJyb3IgcGFyc2luZyBmcm9udG1hdHRlcjonLCBlcnJvcik7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBmcm9udG1hdHRlciwgYm9keSB9O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFZlcmlmaWNhIHNlIHVtIGFycXVpdm8gdGVtIGdyYW5vbGFfaWQgbm8gZnJvbnRtYXR0ZXJcbiAgICAgKi9cbiAgICBoYXNHcmFub2xhSWQoZmlsZTogVEZpbGUpOiBib29sZWFuIHtcbiAgICAgICAgY29uc3QgY2FjaGUgPSB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZShmaWxlKTtcbiAgICAgICAgcmV0dXJuIGNhY2hlPy5mcm9udG1hdHRlcj8uZ3Jhbm9sYV9pZCAhPT0gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE9idFx1MDBFOW0gbyBncmFub2xhX2lkIGRlIHVtIGFycXVpdm9cbiAgICAgKi9cbiAgICBnZXRHcmFub2xhSWQoZmlsZTogVEZpbGUpOiBzdHJpbmcgfCBudWxsIHtcbiAgICAgICAgY29uc3QgY2FjaGUgPSB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZShmaWxlKTtcbiAgICAgICAgcmV0dXJuIGNhY2hlPy5mcm9udG1hdHRlcj8uZ3Jhbm9sYV9pZCB8fCBudWxsO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE9idFx1MDBFOW0gbyB1cGRhdGVkX2F0IGRlIHVtIGFycXVpdm9cbiAgICAgKi9cbiAgICBnZXRVcGRhdGVkQXQoZmlsZTogVEZpbGUpOiBzdHJpbmcgfCBudWxsIHtcbiAgICAgICAgY29uc3QgY2FjaGUgPSB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZShmaWxlKTtcbiAgICAgICAgcmV0dXJuIGNhY2hlPy5mcm9udG1hdHRlcj8udXBkYXRlZF9hdCB8fCBudWxsO1xuICAgIH1cbn0iLCAiaW1wb3J0IHsgVEZpbGUsIEFwcCwgVEZvbGRlciB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCB7IFlhbWxQYXJzZXIgfSBmcm9tICcuLi91dGlscy95YW1sUGFyc2VyJztcblxuZXhwb3J0IGNsYXNzIEZpbGVMb29rdXBTZXJ2aWNlIHtcbiAgICBwcml2YXRlIGFwcDogQXBwO1xuICAgIHByaXZhdGUgeWFtbFBhcnNlcjogWWFtbFBhcnNlcjtcblxuICAgIGNvbnN0cnVjdG9yKGFwcDogQXBwKSB7XG4gICAgICAgIHRoaXMuYXBwID0gYXBwO1xuICAgICAgICB0aGlzLnlhbWxQYXJzZXIgPSBuZXcgWWFtbFBhcnNlcihhcHApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFByb2N1cmEgYXJxdWl2byBwb3IgZ3Jhbm9sYV9pZCBlbSB0b2RvIG8gdmF1bHRcbiAgICAgKi9cbiAgICBhc3luYyBmaW5kRmlsZUJ5R3Jhbm9sYUlkKGdyYW5vbGFJZDogc3RyaW5nKTogUHJvbWlzZTxURmlsZSB8IG51bGw+IHtcbiAgICAgICAgY29uc3QgYWxsRmlsZXMgPSB0aGlzLmFwcC52YXVsdC5nZXRGaWxlcygpO1xuICAgICAgICBcbiAgICAgICAgZm9yIChjb25zdCBmaWxlIG9mIGFsbEZpbGVzKSB7XG4gICAgICAgICAgICBjb25zdCBmaWxlR3Jhbm9sYUlkID0gdGhpcy55YW1sUGFyc2VyLmdldEdyYW5vbGFJZChmaWxlKTtcbiAgICAgICAgICAgIGlmIChmaWxlR3Jhbm9sYUlkID09PSBncmFub2xhSWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmlsZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVmVyaWZpY2Egc2Ugalx1MDBFMSBleGlzdGUgYXJxdWl2byBjb20gZXN0ZSBncmFub2xhX2lkXG4gICAgICovXG4gICAgYXN5bmMgZmlsZUV4aXN0c1dpdGhHcmFub2xhSWQoZ3Jhbm9sYUlkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAgICAgY29uc3QgZXhpc3RpbmdGaWxlID0gYXdhaXQgdGhpcy5maW5kRmlsZUJ5R3Jhbm9sYUlkKGdyYW5vbGFJZCk7XG4gICAgICAgIHJldHVybiBleGlzdGluZ0ZpbGUgIT09IG51bGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTGlzdGEgdG9kb3Mgb3MgYXJxdWl2b3MgY29tIGdyYW5vbGFfaWRcbiAgICAgKi9cbiAgICBhc3luYyBnZXRBbGxHcmFub2xhRmlsZXMoKTogUHJvbWlzZTxURmlsZVtdPiB7XG4gICAgICAgIGNvbnN0IGFsbEZpbGVzID0gdGhpcy5hcHAudmF1bHQuZ2V0RmlsZXMoKTtcbiAgICAgICAgY29uc3QgZ3Jhbm9sYUZpbGVzOiBURmlsZVtdID0gW107XG4gICAgICAgIFxuICAgICAgICBmb3IgKGNvbnN0IGZpbGUgb2YgYWxsRmlsZXMpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnlhbWxQYXJzZXIuaGFzR3Jhbm9sYUlkKGZpbGUpKSB7XG4gICAgICAgICAgICAgICAgZ3Jhbm9sYUZpbGVzLnB1c2goZmlsZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHJldHVybiBncmFub2xhRmlsZXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogT2J0XHUwMEU5bSBhcnF1aXZvcyBkdXBsaWNhZG9zIChtZXNtbyBncmFub2xhX2lkKVxuICAgICAqIElnbm9yYSB0cmFuc2NyaXB0cyBxdWUgY29tcGFydGlsaGFtIGdyYW5vbGFfaWQgY29tIHN1YXMgbm90YXMgcmVsYWNpb25hZGFzXG4gICAgICovXG4gICAgYXN5bmMgZ2V0RHVwbGljYXRlRmlsZXMoKTogUHJvbWlzZTx7IGdyYW5vbGFJZDogc3RyaW5nOyBmaWxlczogVEZpbGVbXSB9W10+IHtcbiAgICAgICAgY29uc3QgZ3Jhbm9sYUZpbGVzID0gYXdhaXQgdGhpcy5nZXRBbGxHcmFub2xhRmlsZXMoKTtcbiAgICAgICAgY29uc3QgZ3Jhbm9sYUlkTWFwID0gbmV3IE1hcDxzdHJpbmcsIFRGaWxlW10+KCk7XG5cbiAgICAgICAgLy8gQWdydXBhIHRvZG9zIG9zIGFycXVpdm9zIHBvciBncmFub2xhX2lkIChpbmNsdWluZG8gdHJhbnNjcmlwdHMpXG4gICAgICAgIGZvciAoY29uc3QgZmlsZSBvZiBncmFub2xhRmlsZXMpIHtcbiAgICAgICAgICAgIGNvbnN0IGdyYW5vbGFJZCA9IHRoaXMueWFtbFBhcnNlci5nZXRHcmFub2xhSWQoZmlsZSk7XG4gICAgICAgICAgICBpZiAoZ3Jhbm9sYUlkKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFncmFub2xhSWRNYXAuaGFzKGdyYW5vbGFJZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgZ3Jhbm9sYUlkTWFwLnNldChncmFub2xhSWQsIFtdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZ3Jhbm9sYUlkTWFwLmdldChncmFub2xhSWQpIS5wdXNoKGZpbGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZHVwbGljYXRlczogeyBncmFub2xhSWQ6IHN0cmluZzsgZmlsZXM6IFRGaWxlW10gfVtdID0gW107XG5cbiAgICAgICAgZm9yIChjb25zdCBbZ3Jhbm9sYUlkLCBmaWxlc10gb2YgZ3Jhbm9sYUlkTWFwKSB7XG4gICAgICAgICAgICAvLyBGaWx0cmEgdHJhbnNjcmlwdHMgZG8gZ3J1cG9cbiAgICAgICAgICAgIGNvbnN0IG5vblRyYW5zY3JpcHRGaWxlcyA9IGZpbGVzLmZpbHRlcihcbiAgICAgICAgICAgICAgICBmaWxlID0+ICFmaWxlLm5hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygndHJhbnNjcmlwdCcpXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAvLyBTXHUwMEYzIGNvbnNpZGVyYSBkdXBsaWNhdGEgc2UgaG91dmVyIG1haXMgZGUgMSBhcnF1aXZvIHF1ZSBOXHUwMEMzTyBzZWphIHRyYW5zY3JpcHRcbiAgICAgICAgICAgIGlmIChub25UcmFuc2NyaXB0RmlsZXMubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgIGR1cGxpY2F0ZXMucHVzaCh7IGdyYW5vbGFJZCwgZmlsZXM6IG5vblRyYW5zY3JpcHRGaWxlcyB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBkdXBsaWNhdGVzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEludGVyY2VwdGEgY3JpYVx1MDBFN1x1MDBFM28gZGUgYXJxdWl2byBwYXJhIHByZXZlbmlyIGR1cGxpY2F0YXNcbiAgICAgKi9cbiAgICBhc3luYyBpbnRlcmNlcHRGaWxlQ3JlYXRpb24oZmlsZVBhdGg6IHN0cmluZywgY29udGVudDogc3RyaW5nKTogUHJvbWlzZTx7IHNob3VsZENyZWF0ZTogYm9vbGVhbjsgYWx0ZXJuYXRpdmVQYXRoPzogc3RyaW5nIH0+IHtcbiAgICAgICAgaWYgKCF0aGlzLnNldHRpbmdzPy5kdXBsaWNhdGVQcmV2ZW50aW9uRW5hYmxlZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc2hvdWxkQ3JlYXRlOiB0cnVlIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB7IGZyb250bWF0dGVyIH0gPSB0aGlzLnlhbWxQYXJzZXIuZXh0cmFjdEZyb250bWF0dGVyKGNvbnRlbnQpO1xuICAgICAgICBjb25zdCBncmFub2xhSWQgPSBmcm9udG1hdHRlci5ncmFub2xhX2lkO1xuXG4gICAgICAgIGlmICghZ3Jhbm9sYUlkKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzaG91bGRDcmVhdGU6IHRydWUgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nRmlsZSA9IGF3YWl0IHRoaXMuZmluZEZpbGVCeUdyYW5vbGFJZChncmFub2xhSWQpO1xuICAgICAgICBpZiAoIWV4aXN0aW5nRmlsZSkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc2hvdWxkQ3JlYXRlOiB0cnVlIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBcnF1aXZvIGNvbSBtZXNtbyBncmFub2xhX2lkIGpcdTAwRTEgZXhpc3RlXG4gICAgICAgIGlmICh0aGlzLnNldHRpbmdzPy5kZWJ1Z01vZGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBHcmFub2xhIENvbXBhbmlvbjogUHJldmVudGluZyBkdXBsaWNhdGUgY3JlYXRpb24gZm9yIGdyYW5vbGFfaWQ6ICR7Z3Jhbm9sYUlkfWApO1xuICAgICAgICAgICAgY29uc29sZS5sb2coYEV4aXN0aW5nIGZpbGU6ICR7ZXhpc3RpbmdGaWxlLnBhdGh9YCk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgQXR0ZW1wdGVkIG5ldyBmaWxlOiAke2ZpbGVQYXRofWApO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHsgXG4gICAgICAgICAgICBzaG91bGRDcmVhdGU6IGZhbHNlLCBcbiAgICAgICAgICAgIGFsdGVybmF0aXZlUGF0aDogZXhpc3RpbmdGaWxlLnBhdGggXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzZXR0aW5nczogYW55O1xuICAgIFxuICAgIHNldFNldHRpbmdzKHNldHRpbmdzOiBhbnkpIHtcbiAgICAgICAgdGhpcy5zZXR0aW5ncyA9IHNldHRpbmdzO1xuICAgIH1cbn0iLCAiaW1wb3J0IHsgQXBwLCBQbHVnaW5NYW5pZmVzdCB9IGZyb20gJ29ic2lkaWFuJztcblxuZXhwb3J0IGludGVyZmFjZSBHcmFub2xhU3luY0luZm8ge1xuICAgIGluc3RhbGxlZDogYm9vbGVhbjtcbiAgICBhdmFpbGFibGU6IGJvb2xlYW47XG4gICAgZW5hYmxlZDogYm9vbGVhbjtcbiAgICBtYW5pZmVzdD86IFBsdWdpbk1hbmlmZXN0O1xufVxuXG5leHBvcnQgY2xhc3MgUGx1Z2luRGV0ZWN0b3Ige1xuICAgIHByaXZhdGUgYXBwOiBBcHA7XG4gICAgcHJpdmF0ZSBwbHVnaW5JZCA9ICdncmFub2xhLXN5bmMnO1xuXG4gICAgY29uc3RydWN0b3IoYXBwOiBBcHApIHtcbiAgICAgICAgdGhpcy5hcHAgPSBhcHA7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0cyBpbmZvcm1hdGlvbiBhYm91dCB0aGUgR3Jhbm9sYSBTeW5jIHBsdWdpblxuICAgICAqL1xuICAgIGdldEdyYW5vbGFTeW5jSW5mbygpOiBHcmFub2xhU3luY0luZm8ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcGx1Z2luc0FQSSA9ICh0aGlzLmFwcCBhcyBhbnkpLnBsdWdpbnM7XG5cbiAgICAgICAgICAgIC8vIENoZWNrIDE6IElzIHRoZSBwbHVnaW4gaW5zdGFsbGVkPyAoZXhpc3RzIGluIG1hbmlmZXN0cylcbiAgICAgICAgICAgIGNvbnN0IG1hbmlmZXN0cyA9IHBsdWdpbnNBUEkubWFuaWZlc3RzIHx8IHt9O1xuICAgICAgICAgICAgY29uc3QgbWFuaWZlc3QgPSBtYW5pZmVzdHNbdGhpcy5wbHVnaW5JZF07XG4gICAgICAgICAgICBjb25zdCBpc0luc3RhbGxlZCA9ICEhbWFuaWZlc3Q7XG5cbiAgICAgICAgICAgIC8vIENoZWNrIDI6IElzIHRoZSBwbHVnaW4gZW5hYmxlZD8gKGV4aXN0cyBpbiBsb2FkZWQgcGx1Z2lucylcbiAgICAgICAgICAgIC8vIFRyeSBtdWx0aXBsZSBtZXRob2RzIGZvciBtYXhpbXVtIGNvbXBhdGliaWxpdHlcbiAgICAgICAgICAgIGxldCBpc0VuYWJsZWQgPSBmYWxzZTtcblxuICAgICAgICAgICAgLy8gTWV0aG9kIDE6IENoZWNrIGlmIHBsdWdpbiBpbnN0YW5jZSBleGlzdHMgaW4gcGx1Z2lucyBvYmplY3RcbiAgICAgICAgICAgIGlmIChwbHVnaW5zQVBJLnBsdWdpbnMgJiYgcGx1Z2luc0FQSS5wbHVnaW5zW3RoaXMucGx1Z2luSWRdKSB7XG4gICAgICAgICAgICAgICAgaXNFbmFibGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gTWV0aG9kIDI6IENoZWNrIGVuYWJsZWRQbHVnaW5zIFNldCAoaWYgYXZhaWxhYmxlKVxuICAgICAgICAgICAgaWYgKCFpc0VuYWJsZWQgJiYgcGx1Z2luc0FQSS5lbmFibGVkUGx1Z2lucykge1xuICAgICAgICAgICAgICAgIGlzRW5hYmxlZCA9IHBsdWdpbnNBUEkuZW5hYmxlZFBsdWdpbnMuaGFzKHRoaXMucGx1Z2luSWQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBDaGVjayAzOiBJcyB0aGUgcGx1Z2luIGF2YWlsYWJsZT8gKGJvdGggaW5zdGFsbGVkIEFORCBlbmFibGVkKVxuICAgICAgICAgICAgY29uc3QgaXNBdmFpbGFibGUgPSBpc0luc3RhbGxlZCAmJiBpc0VuYWJsZWQ7XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgaW5zdGFsbGVkOiBpc0luc3RhbGxlZCxcbiAgICAgICAgICAgICAgICBlbmFibGVkOiBpc0VuYWJsZWQsXG4gICAgICAgICAgICAgICAgYXZhaWxhYmxlOiBpc0F2YWlsYWJsZSxcbiAgICAgICAgICAgICAgICBtYW5pZmVzdDogbWFuaWZlc3QgfHwgdW5kZWZpbmVkXG4gICAgICAgICAgICB9O1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCdFcnJvciBjaGVja2luZyBHcmFub2xhIFN5bmMgc3RhdHVzOicsIGVycm9yKTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgaW5zdGFsbGVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBhdmFpbGFibGU6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGVuYWJsZWQ6IGZhbHNlXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2hvd3MgYSB3YXJuaW5nIHdoZW4gR3Jhbm9sYSBTeW5jIGlzIG5vdCBhdmFpbGFibGVcbiAgICAgKiBQcm92aWRlcyBzcGVjaWZpYyBndWlkYW5jZSBiYXNlZCBvbiB0aGUgY3VycmVudCBzdGF0ZVxuICAgICAqL1xuICAgIHNob3dEZXBlbmRlbmN5V2FybmluZyhpbmZvPzogR3Jhbm9sYVN5bmNJbmZvKSB7XG4gICAgICAgIGlmICghaW5mbykge1xuICAgICAgICAgICAgaW5mbyA9IHRoaXMuZ2V0R3Jhbm9sYVN5bmNJbmZvKCk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgc3RhdHVzTWVzc2FnZTogc3RyaW5nO1xuICAgICAgICBsZXQgYWN0aW9uTWVzc2FnZTogc3RyaW5nO1xuXG4gICAgICAgIGlmICghaW5mby5pbnN0YWxsZWQpIHtcbiAgICAgICAgICAgIHN0YXR1c01lc3NhZ2UgPSAnR3Jhbm9sYSBTeW5jIGlzIG5vdCBpbnN0YWxsZWQnO1xuICAgICAgICAgICAgYWN0aW9uTWVzc2FnZSA9ICdQbGVhc2UgaW5zdGFsbCA8c3Ryb25nPkdyYW5vbGEgU3luYzwvc3Ryb25nPiBmcm9tIHRoZSBDb21tdW5pdHkgUGx1Z2lucyBzZXR0aW5ncy4nO1xuICAgICAgICB9IGVsc2UgaWYgKCFpbmZvLmVuYWJsZWQpIHtcbiAgICAgICAgICAgIHN0YXR1c01lc3NhZ2UgPSAnR3Jhbm9sYSBTeW5jIGlzIGluc3RhbGxlZCBidXQgZGlzYWJsZWQnO1xuICAgICAgICAgICAgYWN0aW9uTWVzc2FnZSA9ICdQbGVhc2UgZW5hYmxlIDxzdHJvbmc+R3Jhbm9sYSBTeW5jPC9zdHJvbmc+IGluIHRoZSBDb21tdW5pdHkgUGx1Z2lucyBzZXR0aW5ncy4nO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc3RhdHVzTWVzc2FnZSA9ICdHcmFub2xhIFN5bmMgc3RhdHVzIHVua25vd24nO1xuICAgICAgICAgICAgYWN0aW9uTWVzc2FnZSA9ICdQbGVhc2UgY2hlY2sgeW91ciBwbHVnaW4gY29uZmlndXJhdGlvbi4nO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBtZXNzYWdlLnN0eWxlLmNzc1RleHQgPSBgXG4gICAgICAgICAgICBwYWRkaW5nOiAxMHB4O1xuICAgICAgICAgICAgYm9yZGVyLWxlZnQ6IDRweCBzb2xpZCAjZmY5ODAwO1xuICAgICAgICAgICAgbWFyZ2luOiAxMHB4IDA7XG4gICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZmZmM2UwO1xuICAgICAgICBgO1xuICAgICAgICBtZXNzYWdlLmlubmVySFRNTCA9IGBcbiAgICAgICAgICAgIDxzdHJvbmc+R3Jhbm9sYSBQbHVnaW4gQ29tcGFuaW9uPC9zdHJvbmc+IHJlcXVpcmVzIDxzdHJvbmc+R3Jhbm9sYSBTeW5jPC9zdHJvbmc+IHRvIGZ1bmN0aW9uIHByb3Blcmx5LlxuICAgICAgICAgICAgPHA+JHthY3Rpb25NZXNzYWdlfTwvcD5cbiAgICAgICAgICAgIDxwPjxlbT5DdXJyZW50IHN0YXR1czogJHtzdGF0dXNNZXNzYWdlfTwvZW0+PC9wPlxuICAgICAgICBgO1xuXG4gICAgICAgIGlmICgodGhpcy5hcHAgYXMgYW55KS5ub3RpY2UpIHtcbiAgICAgICAgICAgICh0aGlzLmFwcCBhcyBhbnkpLm5vdGljZShtZXNzYWdlLCAxMDAwMCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oYEdyYW5vbGEgQ29tcGFuaW9uOiAke3N0YXR1c01lc3NhZ2V9YCk7XG4gICAgICAgIH1cbiAgICB9XG59Il0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLElBQUFBLG1CQUErRDs7O0FDQS9ELHNCQUFvQzs7O0FDUTdCLElBQU0sYUFBTixNQUFpQjtBQUFBLEVBR3BCLFlBQVksS0FBVTtBQUNsQixTQUFLLE1BQU07QUFBQSxFQUNmO0FBQUE7QUFBQTtBQUFBO0FBQUEsRUFLQSxtQkFBbUIsU0FBb0U7QUFDbkYsVUFBTSxtQkFBbUI7QUFDekIsVUFBTSxRQUFRLFFBQVEsTUFBTSxnQkFBZ0I7QUFFNUMsUUFBSSxDQUFDLE9BQU87QUFDUixhQUFPLEVBQUUsYUFBYSxDQUFDLEdBQUcsTUFBTSxRQUFRO0FBQUEsSUFDNUM7QUFFQSxVQUFN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VSxTQUFTLE9BQU8sRUFBRSxLQUFLLG9CQUFvQixHQUFHLENBQUMsU0FBUztBQUM5RCxhQUFLLFNBQVMsT0FBTyxFQUFFLE1BQU0sMENBQWdDLENBQUM7QUFBQSxNQUNsRSxDQUFDO0FBRUQsZ0JBQVUsU0FBUyxPQUFPLEVBQUUsS0FBSywyQkFBMkIsR0FBRyxDQUFDLFNBQVM7QUFDckUsYUFBSyxZQUFZO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxNQUtyQixDQUFDO0FBQ0Q7QUFBQSxJQUNKO0FBRUEsUUFBSSx5QkFBUSxXQUFXLEVBQ2xCLFFBQVEsNkJBQTZCLEVBQ3JDLFFBQVEsb0VBQW9FLEVBQzVFLFVBQVUsWUFBVSxPQUNoQixTQUFTLEtBQUssT0FBTyxTQUFTLDBCQUEwQixFQUN4RCxTQUFTLE9BQU8sVUFBVTtBQUN2QixXQUFLLE9BQU8sU0FBUyw2QkFBNkI7QUFDbEQsWUFBTSxLQUFLLE9BQU8sYUFBYTtBQUFBLElBQ25DLENBQUMsQ0FBQztBQUVWLFFBQUkseUJBQVEsV0FBVyxFQUNsQixRQUFRLFlBQVksRUFDcEIsUUFBUSwwQ0FBMEMsRUFDbEQsVUFBVSxZQUFVLE9BQ2hCLFNBQVMsS0FBSyxPQUFPLFNBQVMsU0FBUyxFQUN2QyxTQUFTLE9BQU8sVUFBVTtBQUN2QixXQUFLLE9BQU8sU0FBUyxZQUFZO0FBQ2pDLFlBQU0sS0FBSyxPQUFPLGFBQWE7QUFBQSxJQUNuQyxDQUFDLENBQUM7QUFHVixnQkFBWSxTQUFTLE9BQU8sRUFBRSxLQUFLLGVBQWUsR0FBRyxDQUFDLFFBQVE7QUFDMUQsVUFBSSxTQUFTLE9BQU8sRUFBRSxLQUFLLG9CQUFvQixHQUFHLENBQUMsU0FBUztBQUN4RCxhQUFLLFNBQVMsT0FBTyxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBQzNDLGFBQUssU0FBUyxPQUFPLEVBQUUsS0FBSyw0QkFBNEIsTUFBTSxxREFBcUQsQ0FBQztBQUFBLE1BQ3hILENBQUM7QUFFRCxVQUFJLFNBQVMsT0FBTyxFQUFFLEtBQUssdUJBQXVCLEdBQUcsQ0FBQyxZQUFZO0FBQzlELGNBQU0sU0FBUyxRQUFRLFNBQVMsVUFBVTtBQUFBLFVBQ3RDLEtBQUs7QUFBQSxVQUNMLE1BQU07QUFBQSxRQUNWLENBQUM7QUFFRCxlQUFPLFVBQVUsTUFBTTtBQUNuQixlQUFLLE9BQU8sbUJBQW1CO0FBQUEsUUFDbkM7QUFBQSxNQUNKLENBQUM7QUFBQSxJQUNMLENBQUM7QUFBQSxFQUNMO0FBQ0o7IiwKICAibmFtZXMiOiBbImltcG9ydF9vYnNpZGlhbiJdCn0K
